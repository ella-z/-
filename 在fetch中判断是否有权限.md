# åœ¨fetchä¸­åˆ¤æ–­æ˜¯å¦æœ‰æƒé™
- é—®é¢˜èƒŒæ™¯ï¼šå› ä¸ºé‰´æƒåœ¨åç«¯å®ç°ï¼Œæ‰€ä»¥å½“ç”¨æˆ·è¯·æ±‚æ²¡æœ‰è®¿é—®æƒé™çš„æ¥å£æ•°æ®çš„æ—¶å€™ï¼Œä¼šè¿”å›auth_failã€‚éœ€æ±‚ï¼šå½“æ¥å£è¿”å›çš„å€¼ä¸ºauth_failæ—¶ï¼Œå¼¹å‡ºæç¤ºå¼¹æ¡†ã€‚è‹¥ä¸ºæ­£å¸¸çš„jsonæ•°æ®è¿”å›æ—¶ï¼Œå°±ç›´æ¥è¿”å›æ•°æ®ã€‚
- è§£å†³é—®é¢˜çš„æ€è·¯ï¼š
   1. å› ä¸ºæ‰€æœ‰çš„è¯·æ±‚éƒ½æ˜¯é€šè¿‡fetchè¿›è¡Œè¯·æ±‚çš„ï¼Œè€Œfetchæ˜¯åŸºäºpromise APIè®¾è®¡çš„ã€‚å…ˆæ¥çœ‹çœ‹æ™®é€šçš„fetchè¯·æ±‚ğŸ‘‡ã€‚
   ```
     ğŸŒ°ï¼š
     fetch('https:xxxxx')
    .then(response => {
      return response.json(); //å› ä¸ºç°åœ¨çš„responseæ•°æ®æ˜¯å¯è¯»æ•°æ®æµï¼Œæ‰€ä»¥éœ€è¦å°†æ•°æ®è½¬æ¢ä¸ºå¯è¯»çš„jsonç±»å‹æ•°æ®
    })
    .then(  res=> {
      console.log(res); //è¾“å‡ºæ•°æ®
    });
   ```
   2. è‹¥åƒä¸Šé¢çš„ä»£ç ä¸€æ ·ï¼Œå½“è¿”å›çš„æ˜¯auth_failæ—¶ï¼Œå› ä¸ºä¸æ˜¯ç¬¦åˆjsonç±»å‹çš„æ•°æ®æµï¼Œæ‰€ä»¥response.json()æ— æ³•æ­£å¸¸è½¬æ¢ä¼šæŠ›å‡ºé”™è¯¯ã€‚è€Œåœ¨responseæ—¶æœŸæ— æ³•è¯†åˆ«æ•°æ®æµçš„é‡Œé¢çš„æ•°æ®å†…å®¹ï¼Œä½†åˆæƒ³åˆ°responseçš„è¿˜æœ‰
   ä¸€ä¸ªtext()æ–¹æ³•ï¼Œå¯ä»¥å°†å¯è¯»æ•°æ®æµè½¬åŒ–ä¸ºå­—ç¬¦ä¸²ç±»å‹çš„å¯è¯»æ•°æ®ã€‚é‚£å¯ä¸å¯ä»¥å°†å¯è¯»æ•°æ®æµä¸­çš„æ•°æ®è½¬åŒ–ä¸ºå¯è¯»çš„å­—ç¬¦ä¸²ç±»å‹æ•°æ®å†è¿›è¡Œåˆ¤æ–­ï¼Œè‹¥ä¸ºauth_failï¼Œåˆ™å¼¹å‡ºæç¤ºæ¡†ã€‚è‹¥ä¸ä¸ºauth_failï¼Œå°±å°†è¯¥æ•°æ®è½¬æ¢ä¸º
   jsonç±»å‹çš„æ•°æ®å¹¶è¿”å›ã€‚
   æ”¹é€ ~ğŸ‘‡ï¼š
   
   ```
   ğŸŒ°ç¬¬ä¸€ç§å†™æ³•ï¼š
     fetch('https:xxxxx')
    .then(response => {
      const result = response.text().then(res => {
           return res;
      })
      return result; 
    })
    .then(res=>{
      if(res === 'auth_fail')
      {
        alert('auth_fail');
        return;
      }else{
        return JSON.parse(res);
      }
    })
    .then(  res=> {
      console.log(res); //è¾“å‡ºæ•°æ®
    });
   ```
   
   ```
   ğŸŒ°ç¬¬äºŒç§å†™æ³•ï¼š
    const responseCopy = response.clone();
    const result = await responseCopy.text().then(res => {
        return res;
    })
    if (result !== 'auth_fail') {
        jsonRes = response.json()
        return jsonRes;
    } else {
        alert('auth_fail');
        return;
    }   
   ```
   3. å®Œæˆ~æ’’èŠ±~â€
   
- è§£å†³é—®é¢˜ä¸­é‡åˆ°çš„å‘ï¼š
   - ç¬¬ä¸€ç‰ˆçš„æƒ³æ³•ï¼šå…ˆå°†responseè½¬åŒ–ä¸ºtext()ç±»å‹çš„æ•°æ®ï¼Œç„¶åå†å°†åˆ¤æ–­è½¬æ¢åçš„å€¼ï¼Œè‹¥ä¸ä¸ºauth_failçš„æ—¶å€™ï¼Œç”¨json()æ–¹æ³•å°†responseè½¬åŒ–ä¸ºjsonç±»å‹çš„æ•°æ®ã€‚
      - ç»“æœï¼šFailed to execute 'json' on 'Response': body stream is locked 
      - åŸå› ï¼š response.json å’Œ response.text æ–¹æ³•åªèƒ½ä½¿ç”¨ä¸€ä¸ªå¹¶ä¸”åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼ŒåŒæ—¶ä½¿ç”¨ä¸¤ä¸ªæˆ–åˆ™ä½¿ç”¨ä¸¤æ¬¡éƒ½ä¼šæŠ¥é”™ã€‚å› ä¸ºæ•°æ®æµåªèƒ½è¯»å–ä¸€æ¬¡ï¼Œä¸€æ—¦è¯»å–ï¼Œæ•°æ®æµå˜ç©ºï¼Œå†æ¬¡è¯»å–ä¼šæŠ¥é”™ã€‚
      - è§£å†³æ–¹æ³•ï¼šå¯ä»¥ä½¿ç”¨response.clone()å¤åˆ¶ä¸€ä¸ªæµï¼Œå†å¯¹è¿™ä¸ªæµè¿›è¡Œæ“ä½œã€‚
- å‚è€ƒ
   - [fetch å¦‚ä½•è¯·æ±‚æ•°æ®](https://segmentfault.com/a/1190000017453672)
   - [Fetch çš„å®ä¾‹è®²è§£](https://juejin.im/post/6844903783571390471#heading-1)







   
   
